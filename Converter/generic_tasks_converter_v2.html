<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MystiGo Generic Task Konverter v3</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #0D2B45; font-weight: 800; margin-bottom: 10px; }
        .code-preview { max-height: 300px; overflow-y: auto; background: #1e293b; color: #a5b4fc; }
    </style>
</head>
<body>

<div class="container">
    <h1 class="text-2xl">üé≤ Generic Task Konverter (v3)</h1>
    <p class="mb-6 text-gray-600 text-sm">
        T√∂ltsd be az Excel/CSV f√°jlt az √∫j strukt√∫r√°val. A program titkos√≠tja a seg√≠ts√©geket, √©s JSON f√°jlt gener√°l bel≈ële.
    </p>

    <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
        <p class="font-bold text-blue-800 text-sm mb-2">Elv√°rt oszlopok (fejl√©c):</p>
        <p class="font-mono text-xs text-blue-700">type | category | question | hint1 | hint2 | solution</p>
    </div>

    <div class="mb-6">
        <label class="block text-sm font-bold text-gray-700 mb-2">F√°jl kiv√°laszt√°sa (.xlsx, .csv)</label>
        <input type="file" id="fileUpload" accept=".xlsx, .xls, .csv" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-500 file:text-white hover:file:bg-orange-600 cursor-pointer"/>
    </div>

    <button onclick="processAndDownload()" class="w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition shadow-lg flex items-center justify-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
        </svg>
        Konvert√°l√°s √©s Let√∂lt√©s
    </button>

    <div class="mt-6">
        <label class="block text-sm font-bold text-gray-700 mb-2">El≈ën√©zet:</label>
        <textarea id="output" readonly class="code-preview w-full p-3 border border-gray-300 rounded font-mono text-xs outline-none"></textarea>
    </div>
</div>

<script>
    //
    const SECRET_KEY = "MystiGo_Szuper_Titkos_Kulcs_2025";

    function encryptText(text) {
        if (!text) return "";
        return CryptoJS.AES.encrypt(String(text).trim(), SECRET_KEY).toString();
    }

    function processAndDownload() {
        const fileInput = document.getElementById('fileUpload');
        const outputArea = document.getElementById('output');

        if (!fileInput.files.length) {
            alert("K√©rlek v√°lassz egy f√°jlt!");
            return;
        }

        const file = fileInput.files[0];
        const reader = new FileReader();

        reader.onload = function(e) {
            try {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                if (jsonData.length === 0) {
                    alert("A f√°jl √ºres!");
                    return;
                }

                const firebaseData = {};

                jsonData.forEach((row, index) => {
                    const taskId = `task_${String(index + 1).padStart(3, '0')}`;
                    
                    // Seg√≠ts√©gek t√∂mb√∂s√≠t√©se √©s titkos√≠t√°sa
                    const hints = [];
                    if (row.hint1) hints.push(encryptText(row.hint1));
                    if (row.hint2) hints.push(encryptText(row.hint2));
                    
                    // Mivel nincs k√ºl√∂n 'answer' oszlop, a 'solution'-t haszn√°ljuk elfogadott v√°laszk√©nt is
                    const rawSolution = row.solution ? String(row.solution).trim() : "";
                    const answersArray = rawSolution ? [rawSolution] : ["K√©sz"];

                    // Story gener√°l√°sa kateg√≥ri√°b√≥l
                    const categoryText = row.category ? row.category : "√Åltal√°nos";
                    const generatedStory = `Kateg√≥ria: ${categoryText}`;

                    firebaseData[taskId] = {
                        // √öj mez≈ëk ment√©se
                        type: row.type || "generic",
                        category: categoryText,
                        
                        // J√°t√©kmotor kompatibilis mez≈ëk
                        story: generatedStory,
                        question: row.question || "Nincs k√©rd√©s megadva.",
                        
                        // V√°laszok (nem titkos√≠tva, a be√≠rt v√°lasz ellen≈ërz√©s√©hez)
                        answers: answersArray, 
                        
                        // Titkos√≠tott adatok
                        hints: hints, 
                        solution: encryptText(rawSolution || "Megold√°s")
                    };
                });

                const jsonString = JSON.stringify(firebaseData, null, 2);
                outputArea.value = jsonString;

                const blob = new Blob([jsonString], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = "generic_tasks_encrypted_v3.json";
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

            } catch (error) {
                console.error(error);
                alert("Hiba: " + error.message);
            }
        };

        reader.readAsArrayBuffer(file);
    }
</script>

</body>
</html>