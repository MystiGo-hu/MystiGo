<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content">
    <title>MystiGo - V√°rosi Kalandj√°t√©k Platform</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        /* --- Arculat friss√≠tve a le√≠r√°s alapj√°n (t√ºrkiz, narancs, s√∂t√©tk√©k) --- */
        :root {
            --brand-cyan: #00CED1; /* T√ºrkiz */
            --brand-blue: #0D2B45; /* S√∂t√©tk√©k */
            --brand-orange: #FFA500; /* Narancs */
            --background-start: #E0F7FA;
            --background-end: #FFFFFF;
            --text-dark: #2D3748;
            --text-heading: var(--brand-blue);
        }
        body { 
            font-family: 'Poppins', sans-serif; 
            background: linear-gradient(180deg, var(--background-start) 0%, var(--background-end) 70%);
            overscroll-behavior-y: contain;
            touch-action: manipulation;
        }
        .main-button {
            background-color: var(--brand-orange);
            color: white;
            font-weight: 600;
            padding: 1rem 2rem;
            border-radius: 9999px;
            box-shadow: 0 10px 25px -5px rgba(255, 165, 0, 0.3), 0 8px 10px -6px rgba(255, 165, 0, 0.3);
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
        }
        .main-button:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 35px -8px rgba(255, 165, 0, 0.35), 0 8px 10px -6px rgba(255, 165, 0, 0.35);
        }
        .main-button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .content-card {
            background-color: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.07);
        }
        #map { 
            height: 200px; 
            width: 100%;
            border-radius: 1rem; 
            border: 3px solid #E0F7FA; 
        }
        .hidden { display: none !important; }

        .player-marker {
            background-color: var(--brand-orange);
            border: 2px solid white;
            border-radius: 50%;
            width: 20px !important;
            height: 20px !important;
            box-shadow: 0 0 10px var(--brand-orange);
        }
        /* task-marker elt√°vol√≠tva, m√°r nem haszn√°ljuk */
        .modal-overlay { z-index: 2000; }
        .geofence-circle {
            animation: pulse 2s infinite;
        }
        
        /* Elt√°vol√≠tva a Leaflet alap√©rtelmezett sz√≠n fel√ºl√≠r√°sa a CSS-ben, hogy a JS vez√©relje azt */
        
        @keyframes pulse {
            0% { stroke-width: 2; opacity: 0.8; }
            70% { stroke-width: 4; opacity: 0.2; }
            100% { stroke-width: 2; opacity: 0.8; }
        }
        .text-brand-orange-500 { color: var(--brand-orange); } /* Seg√©doszt√°ly */
        .text-brand-cyan-500 { color: var(--brand-cyan); } /* Seg√©doszt√°ly */

        /* JAV√çT√ÅS: Fejl√©c √°llapotjelz≈ë m√©ret√©nek glob√°lis cs√∂kkent√©se (kisebb bet≈±/sz√°m a jobb elrendez√©s√©rt) */
        .game-status-bar {
            font-size: 0.75rem; /* text-xs - Kisebb bet≈±m√©ret */
        }
        .game-status-bar .flex {
            gap: 0.5rem; /* Kisebb t√°vols√°g az elemek k√∂z√∂tt */
        }
        .game-status-bar .flex-col {
            gap: 0.5rem; /* Kisebb t√°vols√°g az elemek k√∂z√∂tt */
        }

        /* Vizu√°lis visszajelz√©s a felhaszn√°lt, de √∫jra n√©zhet≈ë seg√≠ts√©gekre */
        button.used {
            background-color: #d1fae5; /* Z√∂ldes h√°tt√©r a megn√©zett seg√≠ts√©gre */
            color: #065f46; /* S√∂t√©tz√∂ld sz√∂veg */
            cursor: pointer;
            border: 1px solid #a7f3d0;
        }
        button.used:hover:not(:disabled) {
            background-color: #a7f3d0;
        }

        /* √ñsszecsukhat√≥ T√∂rt√©net doboz st√≠lusa */
        .story-details {
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 0.75rem;
            background-color: #f7fafc;
            position: relative; /* Fontos a gomb abszol√∫t pozicion√°l√°s√°hoz */
        }
        .story-details summary {
            font-weight: 600;
            color: var(--brand-blue);
            cursor: pointer;
            outline: none;
            padding: 0.5rem 0;
            list-style: none; /* Elt√°vol√≠tja az alap√©rtelmezett nyilat */
            display: flex;
            align-items: center;
        }
        .story-details summary::-webkit-details-marker {
            display: none;
        }
        .story-details summary::before {
            content: '+';
            font-size: 1.25rem;
            margin-right: 0.5rem;
            transition: transform 0.2s;
            line-height: 0;
        }
        .story-details[open] summary::before {
            content: '-';
            transform: rotate(0deg);
        }
        .story-content {
            padding-top: 0.5rem;
            border-top: 1px solid #e2e8f0;
            margin-top: 0.5rem;
        }
        /* Extra CSS a gomb garant√°lt megjelen√≠t√©s√©hez (FELOLVAS√ì GOMB JAV√çT√ÅS) */
        #speak-story-btn {
            position: absolute;
            top: 0.5rem; /* Be√°ll√≠tja a gomb f√ºgg≈ëleges helyzet√©t */
            right: 0.5rem; /* Be√°ll√≠tja a gomb v√≠zszintes helyzet√©t */
            display: flex !important; /* Er≈ësen kik√©nyszer√≠ti a l√°that√≥s√°got */
        }
        
        /* Avat√°r ikonok CSS */
        .avatar-icon {
            display: inline-block;
            margin-right: 0.25rem;
            font-size: 1.25rem; /* text-xl */
            line-height: 1;
        }
        
        /* JAV√çTOTT: J√°t√©k k√∂zbeni log√≥ √©s csapatn√©v st√≠lusa */
        #game-header-logo-container {
            position: absolute;
            top: 0.5rem; 
            left: 1rem;
            display: flex;
            align-items: center;
            z-index: 1000;
        }
        /* LOG√ì M√âRET√âNEK DUPL√ÅZ√ÅSA (60px) */
        #game-header-logo {
            height: 60px; 
            width: auto;
        }
        
        /* √öJ KONT√âNER A K√ñZ√âPRE IGAZ√çTOTT CSAPATN√âVNEK √âS TESZT M√ìD INDIK√ÅTORNAK */
        #center-header-content {
            position: absolute;
            top: 2rem; 
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 1000;
            width: 50%; 
            padding-top: 0.5rem;
        }
        #team-name-container {
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }
        
        /* AZ ID≈êZ√çT≈ê S√ÅV (STATUS BAR) LEJJEBB TOL√ÅSA */
        #game-status-bar {
             position: absolute;
             top: 5rem; /* Elegend≈ë hely a log√≥nak/csapatn√©vnek */
             left: 0;
             right: 0;
        }
        
        /* KIL√âP√âS GOMB EL≈êT√âRBE HOZ√ÅSA */
        #exit-game-btn {
            z-index: 10000 !important;
            top: 1rem; 
        }

        /* Hiba bejelent√©s modal st√≠lusai */
        #report-error-modal {
            z-index: 9999; 
            background-color: rgba(0, 0, 0, 0.7);
        }
        #report-error-modal-content {
            background-color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 90%;
            width: 350px;
        }

        /* --- LANDING PAGE ST√çLUSOK JAV√çT√ÅSA --- */
        .landing-text-container {
             text-align: left; 
             padding: 0 1rem;
        }
        .landing-text-container p {
            margin-bottom: 1.25rem; 
            line-height: 1.8;
            color: var(--text-dark);
            font-size: 1.125rem; 
        }
        .landing-text-container h2 {
            font-size: 2.25rem; 
            font-weight: 800;
            color: var(--brand-blue);
            text-align: center; 
            margin-bottom: 1.5rem;
        }
        .landing-text-container .highlight {
            font-weight: 600;
            color: var(--brand-orange);
            font-style: italic;
        }

        /* √öJ CSS A LANDING LOG√ìNAK */
        #landing-logo-container {
            /* 1. K√âR√âS: CS√ñKKENTETT T√ÅVOLS√ÅG FEL√úL (pt-2 helyett pt-8 volt) */
            padding-top: 0.5rem; 
            height: auto; 
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0; 
        }
        #landing-logo {
            max-width: 70%; 
            height: auto;
            object-fit: contain; 
        }

/* √öJ ST√çLUS AZ IKONOKNAK - M√ìDOS√çTOTT */
        .landing-icons {
            font-size: 2rem; /* A k√©rt ikonok m√©ret√©nek n√∂vel√©se */
            margin-bottom: 1.5rem; 
            color: var(--brand-orange);
        }

        /* 2. K√âR√âS: SZ√ñVEG TELJES SZ√âLESS√âGRE √ÅLL√çT√ÅSA ASZTALI N√âZETBEN */
        @media (min-width: 1024px) {
            .landing-text-container {
                /* Asztali n√©zetben 800px sz√©less√©g≈± tartalom (pl. max-w-2xl) 
                   k√∂z√©pen a jobb olvashat√≥s√°g√©rt, de nem a teljes sz√©less√©g (amit a sz√ºl≈ë is korl√°toz)
                   Ha a teljes k√©perny≈ë sz√©les sz√∂veget akarjuk, akkor ezt a max-w-t kell n√∂velni: 
                   Itt a max-w-sm-et fel√ºl√≠rjuk egy nagyobb sz√©less√©ggel.
                */
                max-width: 800px; /* A nagy sz√©les k√©perny≈ën is olvashat√≥ maradjon */
                margin-left: auto;
                margin-right: auto;
                padding: 0 2rem; /* Kicsit t√∂bb padding oldalra */
            }
            #landing-page {
                 padding: 2rem 1rem; /* Cs√∂kkentj√ºk a Landing Page √°ltal√°nos paddingj√©t */
            }
        }
    </style>
</head>
<body class="overflow-hidden">

    <div id="app-container" class="lg:max-w-full lg:h-screen lg:overflow-hidden max-w-md mx-auto h-[100dvh] flex flex-col relative transition-all duration-500">

        <main id="landing-page" class="flex flex-col items-center justify-between text-center text-brand-blue h-full p-8 overflow-y-auto">
            
            <div id="landing-logo-container">
                <img id="landing-logo" src="./MystiGo_logo.png" alt="MystiGo Log√≥ - Kezd≈ëoldal">
            </div>
             <div class="w-full flex justify-center mt-10 mb-20 flex-shrink-0">
                    <a href="index2.html" class="main-button text-xl !px-10 !py-4">
                        Indul√°s
                    </a>
                </div>
            <div class="w-full flex flex-col items-center justify-start flex-grow">
                
                <div class="landing-text-container max-w-sm mx-auto">
                    <h2>√údv√∂zl√ºnk a MystiGo vil√°g√°ban!</h2>
		    <div class="landing-icons text-center">
                        üêàüß≠ <span class="mx-0"></span> üêæ
                    </div>

                    <p>A MystiGo egy v√°rosi <strong>kalandj√°t√©k</strong>, ahol a <strong>szabadban</strong> barangolhatsz, mik√∂zben rejt√©lyeket oldasz meg √©s felfedezed a k√∂rny√©k titkait.</p>

                    <p>Legyen sz√≥ <strong>gyerekek</strong>r≈ël, <strong>csal√°dokr√≥l</strong>, bar√°ti t√°rsas√°gokr√≥l, <strong>csapat√©p√≠t√©s</strong>r≈ël vagy <strong>oszt√°lykir√°ndul√°s</strong>r√≥l ‚Äì mindenki megtal√°lja a neki val√≥ kalandot.</p>

                    <p>A <strong>MystiGo</strong> seg√≠t kimozdulni a lak√°sb√≥l, de nem kell teljesen elengedned a telefonodat sem, mert az lesz a t√©rk√©ped, a seg√≠t≈ëd √©s a nyomoz√≥t√°rsad is egyben.</p>

                    <p class="highlight">
                        üéí Indulj el, fedezd fel a v√°rost, √©s gy≈±jts MystiPoint-okat minden kaland ut√°n!
                    </p>
                    <p>Fedezd fel a vil√°got, l√©p√©sr≈ël l√©p√©sre ‚Äì <strong>MystiGo</strong>-val.</p>

                    <p class="text-center mt-6 text-2xl font-bold text-brand-blue">K√©szen √°llsz a kalandra?</p>
                </div>

                <div class="w-full flex justify-center mt-10 mb-20 flex-shrink-0">
                    <a href="index2.html" class="main-button text-xl !px-10 !py-4">
                        Indul√°s
                    </a>
                </div>
                <p id="loading-status" class="text-gray-600 my-4 h-5 hidden">Adatb√°zis automatikus bet√∂lt√©se...</p>
                <label for="excel-file-input-manual" id="manual-file-select-label" class="main-button w-full text-sm block cursor-pointer my-4 !bg-brand-blue hover:!bg-cyan-700 hidden">
                    Manu√°lis J√°t√©kf√°jl Kiv√°laszt√°sa
                </label>
                <input type="file" id="excel-file-input-manual" class="hidden" accept=".xlsx,.txt,.db">
                <div id="game-order-setup" class="my-4 p-4 bg-gray-50 rounded-xl hidden"></div> 
                <div id="team-setup" class="mt-6 p-4 bg-gray-50 rounded-xl hidden"></div>
            </div>
            
            </main>
        
        <div id="content-wrapper" class="hidden absolute inset-0 transition-transform duration-500 translate-y-full">
            <div id="header" class="relative text-text-heading text-center pt-1 pb-16">
                 <div id="main-header">
                    <div class="flex justify-center mb-2">
                        <img src="./MystiGo_logo.png" alt="MystiGo Log√≥" class="max-h-24 w-auto">
                    </div>
                    <h1 id="page-title" class="text-sm font-bold tracking-wider">V√°lassz Kalandot</h1>
                 </div>
                 
                 <div id="game-header-logo-container" class="hidden">
                    <img id="game-header-logo" src="./MystiGo_logo.png" alt="MystiGo Log√≥">
                 </div>
                 
                 <div id="center-header-content" class="hidden">
                     <div id="team-name-container" class="text-sm font-semibold text-brand-blue/80 block">
                        <span id="game-team-avatar-icon" class="avatar-icon"></span>
                        <span id="team-name-display"></span>
                     </div>
                     <span id="test-mode-indicator" class="text-xs font-bold text-brand-orange-500 hidden mt-1">TESZT M√ìD (NINCS GPS KORL√ÅTOZ√ÅS)</span>
                 </div>
                 
                 <div id="game-status-bar" class="hidden px-6">
                    <div class="bg-white/70 backdrop-blur-sm rounded-full flex justify-between items-center p-2 text-xs font-semibold shadow-sm">
                        <div class="px-3">Feladat: <span id="task-progress-display">1/10</span></div>
                        <div class="flex items-center gap-2">
                            <div class="flex items-center gap-1 bg-white px-2 py-0.5 rounded-full text-brand-cyan-500">
                                <svg class="w-3 h-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.415L11 9.586V6z" clip-rule="evenodd" /></svg>
                                <span id="timer-display">00:00</span>
                            </div>
                            <div class="flex items-center gap-1 bg-white px-2 py-0.5 rounded-full text-green-600">
                                <svg class="w-3 h-3" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9V8h2v8zm4 0h-2V8h2v8z"/></svg>
                                <span id="geofence-timer-display">00:00</span>
                            </div>
                            <div class="flex items-center gap-1 bg-white px-2 py-0.5 rounded-full text-brand-orange-500">
                                <svg class="w-3 h-3" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1-81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                                <span id="score-display">0</span>
                            </div>
                        </div>
                    </div>
                 </div>
                 
                 <button id="exit-game-btn" onclick="showExitConfirmation()" class="absolute top-4 right-4 p-2 rounded-full bg-red-500 text-white shadow-lg hover:bg-red-600 transition hidden" style="z-index: 10000;">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                 </button>
                 
                 <svg class="absolute bottom-0 left-0 w-full" viewBox="0 0 1440 120" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1440 120H0V65.1721C0 65.1721 289.431 0 720 0C1150.57 0 1440 65.1721 1440 65.1721V120Z" fill="white"/></svg>
            </div>
            
            <div id="content-page-wrapper" class="absolute top-32 bottom-0 left-0 right-0 overflow-y-auto px-6 pb-6 bg-white">
                
                <section id="game-list-page" class="hidden">
                    </section>
                
                <section id="game-page" class="hidden space-y-6">
                    </section>
                
                <section id="end-page" class="hidden space-y-6 text-center flex flex-col items-center pt-8">
                    </section>
            </div>
        </div>
        </div>
    
    <script>
        // --- GLOBAL STATE & CONSTANTS ---
        let games = {};
        const GEOFENCE_DEFAULT_RADIUS = 20; 
        const DEFAULT_SCORE_PER_TASK = 100; 
        const HINT1_PENALTY = 20; 
        const HINT2_PENALTY = 30; 
        const SOLUTION_PENALTY = 50; 
        const WRONG_ANSWER_PENALTY = 1; 
        const RESCUE_TASK_CORRECT_ANSWER = '4'; 
        const RESCUE_TASK_SCORE = 0; 
        const LOCAL_STORAGE_KEY = 'MystiGoGameState'; 
        const DEFAULT_GAME_FILE = 'gamex.txt'; 

        const AVATAR_ICONS = {
            cat: 'üêà',
    	    detective: 'üïµÔ∏è',
	    explorer: 'üß≠',
	    wizard: 'üßô',
	    robot: 'ü§ñ',
	    ghost: 'üëª',
	    lock: 'üîê',
	    magician: 'üé©',
	    mask: 'üé≠',
	    fire: 'üî•',
	    knight: '‚öîÔ∏è',
        };

        let appState = {};
        let modalCloseCallback = null;
        let manualMarker = null; 
        let speechSynth = window.speechSynthesis; 

        function initializeState() {
            appState = { currentPage: 'landing-page', selectedGameId: null, currentGame: null, currentTaskIndex: 0, score: 0, timerInterval: null, geofenceTimerInterval: null, startTime: null, map: null, playerMarker: null, taskMarker: null, geofenceCircle: null, userPosition: null, geoWatchId: null, isInZone: false, isTestModeEnabled: false, isManualMock: false, teamName: null, teamAvatar: null, taskOrder: 'sequential', totalTime: 0, geofenceTime: 0, isTimerRunning: false, routeCoordinates: [] };
        }
        
        // ... (A fenti funkci√≥k (saveGameState, loadGameState, loadLocalXlsx stb.) k√≥dja v√°ltozatlan) ...
        
        // --- CORE APP & PAGE LOGIC ---
        function showPage(pageId) {
            const landingPage = document.getElementById('landing-page');
            const contentWrapper = document.getElementById('content-wrapper');
            
            if (pageId === 'landing-page') {
                landingPage.classList.remove('hidden');
                contentWrapper.classList.add('translate-y-full');
            } else {
                landingPage.classList.add('hidden');
                contentWrapper.classList.remove('hidden');
                setTimeout(() => contentWrapper.classList.remove('translate-y-full'), 10);
                showContentPage(pageId);
            }
        }

        // ... (A showContentPage, resetApp, showLoading, showMessage, processExcelData funkci√≥k k√≥dja v√°ltozatlan) ...
        
        // ... (A t√∂bbi funkci√≥ (loadTask, endGame, initializeMap, watchPosition, checkGeofence, stb.) k√≥dja v√°ltozatlan) ...

        // --- EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', () => {
            
            // Kezd≈ëoldali gombok (titkos kapcsol√≥k)
            const testModeToggleLanding = document.getElementById('test-mode-toggle');
            const manualMockToggleLanding = document.getElementById('manual-mock-toggle');
            const manualFileSelectLabel = document.getElementById('manual-file-select-label');
            const manualFileInput = document.getElementById('excel-file-input-manual'); 
            
            const secretSwitchesContainer = document.getElementById('secret-switches-container');
            if (secretSwitchesContainer) secretSwitchesContainer.classList.add('hidden');


            initializeState();

            const continued = loadGameState();

            if (!continued) {
                showPage('landing-page');
            }

            document.getElementById('modal-ok-button').onclick = hideMessage;
            document.getElementById('modal-cancel-button').onclick = hideMessage;
            
            if (manualFileInput) {
                 manualFileInput.addEventListener('change', (event) => {
                    const file = event.target.files[0]; if (!file) return; 
                    showLoading(true);
                    const reader = new FileReader();
                    reader.onload = (e) => { 
                        try {
                            const wb = XLSX.read(new Uint8Array(e.target.result),{type:'array'}); 
                            processExcelData(wb);
                            if (manualFileSelectLabel) manualFileSelectLabel.classList.add('hidden');
                        } catch (error) {
                            showMessage('Feldolgoz√°si Hiba', `Hiba: ${error.message}`);
                            showLoading(false);
                        }
                    };
                    reader.onerror = () => { showMessage('Hiba', 'F√°jl olvas√°si hiba.'); showLoading(false); };
                    reader.readAsArrayBuffer(file);
                });
            }
            
            const excelFileInput = document.getElementById('excel-file-input');
            if (excelFileInput) {
                excelFileInput.addEventListener('change', (event) => {
                    const file = event.target.files[0]; if (!file) return; 
                    showLoading(true);
                    const reader = new FileReader();
                    reader.onload = (e) => { 
                        try {
                            const wb = XLSX.read(new Uint8Array(e.target.result),{type:'array'}); 
                            processExcelData(wb);
                        } catch (error) {
                            showMessage('Feldolgoz√°si Hiba', `Hiba: ${error.message}`);
                            showLoading(false);
                        }
                    };
                    reader.onerror = () => { showMessage('Hiba', 'F√°jl olvas√°si hiba.'); showLoading(false); };
                    reader.readAsArrayBuffer(file);
                });
            }

            document.getElementById('answer-input').addEventListener('focus', (e) => {
                const inputElement = e.target;
                
                inputElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start' 
                });
                
                setTimeout(() => {
                    const wrapper = document.getElementById('content-page-wrapper');
                    const inputTop = inputElement.offsetTop;
                    
                    wrapper.scrollTo({
                        top: inputTop - 30, 
                        behavior: 'smooth'
                    });
                }, 150); 
            });
            
        }); 
    </script>
</body>
</html>