<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MystiGo Game Creator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #0D2B45; /* brand-blue */
            border-bottom: 2px solid #00CED1; /* brand-cyan */
            padding-bottom: 10px;
        }
        h2 {
            color: #FFA500; /* brand-orange */
            margin-top: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
            color: #2D3748;
        }
        input[type="text"], input[type="number"], textarea, select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .button-group {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        .main-button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        .save-button {
            background-color: #00CED1; /* brand-cyan */
            color: white;
        }
        .save-button:hover {
            background-color: #008080;
        }
        .add-task-button {
            background-color: #FFA500; /* brand-orange */
            color: white;
        }
        .add-task-button:hover {
            background-color: #cc8400;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            vertical-align: top;
        }
        th {
            background-color: #0D2B45;
            color: white;
        }
        td input, td textarea {
            min-width: 150px;
        }
        .index-cell {
            width: 40px;
            text-align: center;
            font-weight: bold;
            background-color: #f9f9f9;
        }
        .action-cell {
            width: 120px;
            text-align: center;
        }
        .action-cell button {
            margin: 2px;
            padding: 5px 10px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        /* √öJ ST√çLUSOK A GPS GOMBHOZ √âS ELRENDEZ√âSHEZ */
        .input-with-button {
            display: flex;
            gap: 5px; /* Kisebb t√°vols√°g a mez≈ë √©s a gomb k√∂z√∂tt */
        }
        .input-with-button input {
            flex-grow: 1;
        }
        .gps-button {
            flex-shrink: 0; /* Megakad√°lyozza, hogy a gomb zsugorodjon */
            width: 40px;
            height: 40px; /* Az input mez≈ë magass√°g√°val megegyez≈ë magass√°g */
            padding: 0;
            font-size: 18px;
            cursor: pointer;
            background-color: #00CED1; /* brand-cyan */
            color: white;
            border: none;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: background-color 0.2s;
            line-height: 40px; /* Vertik√°lis k√∂z√©pre igaz√≠t√°s */
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .gps-button:hover {
            background-color: #008080; /* S√∂t√©tebb cyan */
        }
        .text-red-500 { color: #dc3545; }
        .text-green-500 { color: #28a745; }
        .text-gray-400 { color: #ccc; }
    </style>
</head>
<body>
    <div class="container">
        <h1>MystiGo J√°t√©k Szerkeszt≈ë (v1.0)</h1>
        <p id="save-status" class="text-xs text-gray-400 mt-2 mb-4">Autosave akt√≠v</p>
        
        <section id="game-settings">
            <h2>J√°t√©k Be√°ll√≠t√°sok</h2>
            <label for="input-game-title">J√°t√©k C√≠m (Title):</label>
            <input type="text" id="input-game-title" required>

            <label for="input-game-type">J√°t√©k T√≠pus (Type):</label>
            <select id="input-game-type" required>
                <option value="normal">normal üß≠ (√Åltal√°nos, Szekvenci√°lis)</option>
                <option value="kids">kids üë∂ (Gyerekeknek, Szekvenci√°lis)</option>
                <option value="team">team üßë‚Äçü§ù‚Äçüßë (Csapat, Random Feladatok)</option>
            </select>
            
            <label for="input-game-price">√År (price - Ft):</label>
            <input type="number" id="input-game-price" value="0" min="0">

            <label for="input-game-description">Le√≠r√°s (description):</label>
            <textarea id="input-game-description"></textarea>
            
            <h3>Kezd≈ëpont (Start Location)</h3>
            <label for="input-start-lat">Kezd≈ë Koordin√°ta (sz√©less√©g):</label>
            <div class="input-with-button">
                <input type="text" id="input-start-lat" required>
                <button type="button" class="gps-button" title="Aktu√°lis poz√≠ci√≥ bet√∂lt√©se" onclick="getGpsLocation('start-lat')">üìç</button>
            </div>

            <label for="input-start-lng">Kezd≈ë Koordin√°ta (hossz√∫s√°g):</label>
            <div class="input-with-button">
                <input type="text" id="input-start-lng" required>
                <button type="button" class="gps-button" title="Aktu√°lis poz√≠ci√≥ bet√∂lt√©se" onclick="getGpsLocation('start-lng')">üìç</button>
            </div>

            <label for="input-end-story">Befejez≈ë T√∂rt√©net (endStory):</label>
            <textarea id="input-end-story" rows="4"></textarea>

        </section>

        <section id="task-list">
            <h2>Feladatok (Tasks)</h2>
            
            <div class="button-group">
                <button class="main-button add-task-button" onclick="addTaskRow()">√öj Feladat Hozz√°ad√°sa</button>
            </div>

            <p style="font-size: 0.9em; color: #555; margin-top: 10px;">
                * **Index:** A feladat sorsz√°ma a f√°jlban. A v√©gs≈ë sorrendet a J√°t√©k T√≠pus hat√°rozza meg (Normal/Kids: Szekvenci√°lis; Team: Random, az els≈ë √©s utols√≥ kiv√©tel√©vel).
            </p>

            <div style="overflow-x: auto;">
                <table id="task-table">
                    <thead>
                        <tr>
                            <th class="index-cell">Index</th>
                            <th>GameId</th>
                            <th>Loc. Sz√©l.</th>
                            <th>Loc. Hoss.</th>
                            <th>GeoF. R. (m)</th>
                            <th>Prompt (K√©rd√©s)</th>
                            <th>Solution (Helyes v√°lasz)</th>
                            <th>Hint1</th>
                            <th>Hint2</th>
                            <th>Story</th>
                            <th>Accepted Answers (synonym)</th>
                            <th>Synonyms (accepted_answers)</th>
                            <th class="action-cell">M≈±velet</th>
                        </tr>
                    </thead>
                    <tbody id="task-table-body">
                        </tbody>
                </table>
            </div>
            
        </section>

        <section id="export-section">
            <h2>Export√°l√°s</h2>
            <div class="button-group">
                <button class="main-button save-button" id="save-xlsx-button">J√°t√©kf√°jl Ment√©se (.xlsx)</button>
            </div>
        </section>
    </div>

    <script>
        const CREATOR_STORAGE_KEY = 'MystiGoCreatorState'; // Kulcs a localStorage-hoz
        const GEOFENCE_DEFAULT_RADIUS = 20;

        // --- ADATGY≈∞JT√âS √âS ADATOSZT√ÅS SEG√âDF√úGGV√âNYEK ---

        /**
         * √ñsszegy≈±jti az √∂sszes sz√ºks√©ges adatot a szerkeszt≈ëfel√ºletr≈ël.
         */
        function getCreatorData() {
            const gameConfig = {
                title: document.getElementById('input-game-title').value,
                type: document.getElementById('input-game-type').value,
                description: document.getElementById('input-game-description').value,
                startLocationLat: document.getElementById('input-start-lat').value,
                startLocationLng: document.getElementById('input-start-lng').value,
                endStory: document.getElementById('input-end-story').value,
                price: document.getElementById('input-game-price').value
            };

            const tasks = [];
            const taskRows = document.getElementById('task-table-body').querySelectorAll('tr');

            taskRows.forEach((row, rowIndex) => {
                const inputs = row.querySelectorAll('input, textarea');
                
                // Mivel az inputoknak nincs ID-j√ºk, a fix sorrendet felt√©telezz√ºk:
                // 0: GameId, 1: Index, 2: Lat, 3: Lng, 4: Radius, 5: Prompt, 6: Solution, 7: Hint1, 8: Hint2, 9: Story, 10: Accepted, 11: Synonyms
                tasks.push({
                    gameId: inputs[0] ? inputs[0].value : '',
                    index: rowIndex + 1, // Az indexet a sort√≥l √∫jra gener√°ljuk, hogy helyes legyen a visszat√∂lt√©skor
                    locationLat: inputs[2] ? inputs[2].value : '',
                    locationLng: inputs[3] ? inputs[3].value : '',
                    geofenceRadius: inputs[4] ? inputs[4].value : GEOFENCE_DEFAULT_RADIUS,
                    prompt: inputs[5] ? inputs[5].value : '',
                    solution: inputs[6] ? inputs[6].value : '',
                    hint1: inputs[7] ? inputs[7].value : '',
                    hint2: inputs[8] ? inputs[8].value : '',
                    story: inputs[9] ? inputs[9].value : '',
                    accepted_answers: inputs[10] ? inputs[10].value : '',
                    synonyms: inputs[11] ? inputs[11].value : ''
                });
            });
            
            return { config: gameConfig, tasks: tasks };
        }

        /**
         * Bet√∂lti a mentett adatokat a szerkeszt≈ëfel√ºletre (visszat√∂lti a beviteli mez≈ëket).
         * @param {object} data - A mentett √°llapotot tartalmaz√≥ objektum.
         */
        function loadCreatorUI(data) {
            if (!data || !data.config || !data.tasks) return;

            // 1. Game Config bet√∂lt√©se
            document.getElementById('input-game-title').value = data.config.title || '';
            document.getElementById('input-game-type').value = data.config.type || 'normal';
            document.getElementById('input-game-description').value = data.config.description || '';
            document.getElementById('input-start-lat').value = data.config.startLocationLat || '';
            document.getElementById('input-start-lng').value = data.config.startLocationLng || '';
            document.getElementById('input-end-story').value = data.config.endStory || '';
            document.getElementById('input-game-price').value = data.config.price || '0';

            // 2. Feladatok bet√∂lt√©se a t√°bl√°zatba (megl√©v≈ë sorok t√∂rl√©se √©s √∫jak gener√°l√°sa)
            document.getElementById('task-table-body').innerHTML = '';
            
            data.tasks.forEach(task => {
                // A task objektumot √°tadjuk az addTaskRow-nak, ami gener√°lja a sort √©s bet√∂lti az √©rt√©keket
                addTaskRow(task); 
            });
            
            updateTaskIndices(); // Indexek friss√≠t√©se a bet√∂lt√∂tt t√°bl√°zatban
            
            // alert(`Sikeresen folytatva a(z) "${data.config.title || 'N√©vtelen j√°t√©k'}" szerkeszt√©s√©t.`);
        }

        /**
         * T√∂rli a mentett szerkeszt√©si √°llapotot a localStorage-b√≥l.
         */
        function clearCreatorState() {
            localStorage.removeItem(CREATOR_STORAGE_KEY);
        }

        // --- MENT√âSI LOGIKA ---

        /**
         * Elmenti az aktu√°lis szerkeszt√©si √°llapotot a localStorage-ba.
         */
        function saveCreatorState() {
            const data = getCreatorData();
            // Ne ments√ºnk, ha √ºres a c√≠m (felt√©telezve, hogy csak GameId n√©lk√ºl ment√ºnk)
            if (data.config.title.trim() === '' || data.tasks.length === 0) return; 

            const stateToSave = {
                ...data,
                timestamp: new Date().toISOString()
            };
            
            try {
                localStorage.setItem(CREATOR_STORAGE_KEY, JSON.stringify(stateToSave));
                console.log(`[Autosave] √Ållapot elmentve: ${data.config.title}`);
                // UI visszajelz√©s
                const saveStatus = document.getElementById('save-status');
                if (saveStatus) {
                    saveStatus.innerText = `Mentve: ${new Date().toLocaleTimeString('hu-HU')}`;
                    saveStatus.classList.remove('text-red-500');
                    saveStatus.classList.add('text-green-500');
                    setTimeout(() => {
                        saveStatus.innerText = 'Autosave akt√≠v';
                        saveStatus.classList.remove('text-green-500');
                    }, 3000);
                }
            } catch (e) {
                console.error("Hiba a szerkeszt≈ëi √°llapot ment√©sekor:", e);
            }
        }


        // --- VISSZAT√ñLT√âSI LOGIKA ---

        /**
         * Visszat√∂lti az √°llapotot a localStorage-b√≥l, ha van ment√©s.
         */
        function loadCreatorState() {
            try {
                const savedState = localStorage.getItem(CREATOR_STORAGE_KEY);
                if (!savedState) return false;

                const state = JSON.parse(savedState);
                const lastSaved = new Date(state.timestamp).toLocaleString('hu-HU');
                const gameTitle = state.config.title || 'N√©vtelen j√°t√©k';

                if (confirm(`Tal√°ltunk egy mentett szerkeszt√©st a(z) "${gameTitle}" j√°t√©kr√≥l, (${lastSaved}). Szeretn√©d folytatni? (OK=Folytat√°s, M√©gse=√öj j√°t√©k)`)) {
                    loadCreatorUI(state);
                    return true;
                } else {
                    clearCreatorState();
                    return false;
                }

            } catch (e) {
                console.error("Hiba a szerkeszt≈ëi √°llapot bet√∂lt√©sekor:", e);
                clearCreatorState(); // T√∂r√∂lj√ºk a s√©r√ºlt ment√©st
                return false;
            }
        }

        // --- GPS LOGIKA ---

        /**
         * Lek√©ri az aktu√°lis GPS poz√≠ci√≥t √©s be√≠rja a megfelel≈ë koordin√°ta mez≈ëbe.
         * @param {string} targetId - A c√©lt√©rk√©p ID-je ('start-lat', 'start-lng', 'lat', 'lng')
         */
        function getGpsLocation(targetId) {
            if (!navigator.geolocation) {
                alert('A b√∂ng√©sz≈ëd nem t√°mogatja a helymeghat√°roz√°st.');
                return;
            }

            const button = event.currentTarget;
            button.disabled = true;
            button.innerHTML = 'üì°';

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude.toFixed(6);
                    const lng = position.coords.longitude.toFixed(6);
                    
                    // Speci√°lis kezel√©s a Start Location-h√∂z
                    if (targetId === 'start-lat') {
                        document.getElementById('input-start-lat').value = lat;
                    } else if (targetId === 'start-lng') {
                        document.getElementById('input-start-lng').value = lng;
                    } 
                    // Norm√°l Task sor koordin√°t√°khoz
                    else {
                        const inputField = button.previousElementSibling; // Az input mez≈ë a gomb el≈ëtt van
                        if (inputField) inputField.value = (targetId === 'lat') ? lat : lng;
                    }

                    button.disabled = false;
                    button.innerHTML = 'üìç';
                    // alert(`Poz√≠ci√≥ bet√∂ltve: ${lat}, ${lng}`);
                },
                (error) => {
                    console.error("Helymeghat√°roz√°si hiba:", error);
                    let errorMessage = "Hiba a GPS poz√≠ci√≥ lek√©r√©sekor.";
                    if (error.code === error.PERMISSION_DENIED) {
                        errorMessage = "Hozz√°f√©r√©s megtagadva! Enged√©lyezd a helymeghat√°roz√°st a b√∂ng√©sz≈ëdben.";
                    } else if (error.code === error.POSITION_UNAVAILABLE) {
                        errorMessage = "A helyinform√°ci√≥ nem el√©rhet≈ë.";
                    }
                    
                    alert(errorMessage);
                    button.disabled = false;
                    button.innerHTML = 'üìç';
                },
                {
                    enableHighAccuracy: true, 
                    timeout: 5000, 
                    maximumAge: 0
                }
            );
        }

        // --- T√ÅBL√ÅZAT MANIPUL√ÅCI√ì ---
        
        // A megl√©v≈ë addTaskRow f√ºggv√©ny m√≥dos√≠t√°sa, hogy opcion√°lisan fogadjon adatokat
        function addTaskRow(taskData = {}) {
            const tbody = document.getElementById('task-table-body');
            const newRow = tbody.insertRow();
            
            const taskIndex = tbody.rows.length; // Az index a sorok sz√°m√°val egyezik
            
            // Alap√©rtelmezett √©rt√©kek be√°ll√≠t√°sa, ha nincs mentett adat
            const defaults = {
                gameId: document.getElementById('input-game-title').value || '',
                index: taskIndex,
                locationLat: '',
                locationLng: '',
                geofenceRadius: GEOFENCE_DEFAULT_RADIUS,
                prompt: '',
                solution: '',
                hint1: '',
                hint2: '',
                story: '',
                accepted_answers: '',
                synonyms: '',
                ...taskData // Fel√ºl√≠rjuk az alap√©rt√©keket a mentett adatokkal
            };

            // Index Cell
            newRow.insertCell().innerHTML = `<div class="index-cell">${defaults.index}</div>`;
            
            // GameId
            newRow.insertCell().innerHTML = `<input type="text" value="${defaults.gameId}" placeholder="Pl. Eger_kaland_2024">`;
            
            // Location Lat + GPS gomb
            newRow.insertCell().innerHTML = `<div class="input-with-button">
                                                <input type="text" value="${defaults.locationLat}" placeholder="47.9026" required>
                                                <button type="button" class="gps-button" title="Poz√≠ci√≥ bet√∂lt√©se" onclick="getGpsLocation('lat')">üìç</button>
                                            </div>`;

            // Location Lng + GPS gomb
            newRow.insertCell().innerHTML = `<div class="input-with-button">
                                                <input type="text" value="${defaults.locationLng}" placeholder="20.3777" required>
                                                <button type="button" class="gps-button" title="Poz√≠ci√≥ bet√∂lt√©se" onclick="getGpsLocation('lng')">üìç</button>
                                            </div>`;

            // Geofence Radius
            newRow.insertCell().innerHTML = `<input type="number" value="${defaults.geofenceRadius}" min="5" placeholder="${GEOFENCE_DEFAULT_RADIUS}">`;
            
            // Prompt, Solution, Hints, Story, Accepted Answers, Synonyms
            newRow.insertCell().innerHTML = `<textarea rows="2" placeholder="A k√©rd√©s, ami megjelenik">${defaults.prompt}</textarea>`;
            newRow.insertCell().innerHTML = `<input type="text" value="${defaults.solution}" placeholder="A titkos megold√°s">`;
            newRow.insertCell().innerHTML = `<input type="text" value="${defaults.hint1}" placeholder="-20 pont">`;
            newRow.insertCell().innerHTML = `<input type="text" value="${defaults.hint2}" placeholder="-30 pont">`;
            newRow.insertCell().innerHTML = `<textarea rows="3" placeholder="A feladat t√∂rt√©nete">${defaults.story}</textarea>`;
            newRow.insertCell().innerHTML = `<input type="text" value="${defaults.accepted_answers}" placeholder="Szavak; pontosvessz≈ëvel elv√°lasztva">`;
            newRow.insertCell().innerHTML = `<input type="text" value="${defaults.synonyms}" placeholder="Synonymok; pontosvessz≈ëvel elv√°lasztva">`;

            // Action buttons
            newRow.insertCell().innerHTML = `<div class="action-cell">
                                                <button onclick="moveRow(this, -1)">‚Üë Fel</button>
                                                <button onclick="moveRow(this, 1)">‚Üì Le</button>
                                                <button onclick="removeTaskRow(this)">T√∂r√∂l</button>
                                            </div>`;
            
            // Friss√≠tj√ºk a GameId-t a t√°bl√°zat √∂sszes sor√°ban a fenti Game Title alapj√°n, ha nincs mentett adat
            if (!taskData.gameId) {
                 updateGameIds();
            }
        }

        function removeTaskRow(button) {
            if (!confirm("Biztosan t√∂r√∂lni szeretn√©d ezt a feladatot?")) return;
            const row = button.closest('tr');
            row.remove();
            updateTaskIndices();
        }

        function moveRow(button, direction) {
            const row = button.closest('tr');
            const tbody = document.getElementById('task-table-body');
            const index = row.rowIndex - 1; // -1 a thead miatt
            const targetIndex = index + direction;

            if (targetIndex >= 0 && targetIndex < tbody.rows.length) {
                if (direction === -1) {
                    tbody.insertBefore(row, tbody.rows[targetIndex]);
                } else {
                    tbody.insertBefore(row, tbody.rows[targetIndex + 1]);
                }
                updateTaskIndices();
            }
        }

        function updateTaskIndices() {
            const tbody = document.getElementById('task-table-body');
            Array.from(tbody.rows).forEach((row, index) => {
                // Index cell friss√≠t√©se
                row.cells[0].innerHTML = `<div class="index-cell">${index + 1}</div>`;
                
                // Mivel a GameId input a 2. cell√°ban van (index 1), ezt haszn√°ljuk GameId friss√≠t√©sre
                // Az index inputot elt√°vol√≠tottam, mert automatikus a sorrend.
            });
        }
        
        function updateGameIds() {
             const gameIdValue = document.getElementById('input-game-title').value.trim();
             const tbody = document.getElementById('task-table-body');
             Array.from(tbody.rows).forEach((row) => {
                const gameIdInput = row.cells[1].querySelector('input');
                if (gameIdInput) {
                    gameIdInput.value = gameIdValue;
                }
             });
        }


        // --- XLSX EXPORT LOGIKA ---

        function saveGameData() {
            const data = getCreatorData();
            const config = data.config;
            const tasks = data.tasks;

            if (!config.title || !config.startLocationLat || !config.startLocationLng || tasks.length === 0) {
                alert("K√©rj√ºk, t√∂ltsd ki a J√°t√©k C√≠m√©t, a Kezd≈ëpont koordin√°t√°it √©s adj hozz√° legal√°bb egy feladatot.");
                return false;
            }
            
            // F≈ë t√°bl√°zat adatai
            const gameData = [
                ['id', 'title', 'type', 'startLocationLat', 'startLocationLng', 'description', 'endStory', 'imageUrl', 'price'],
                [
                    config.title,
                    config.title,
                    config.type,
                    config.startLocationLat,
                    config.startLocationLng,
                    config.description,
                    config.endStory,
                    '', // imageUrl - placeholder
                    config.price
                ]
            ];

            // Feladatok t√°bl√°zat adatai
            const taskData = [
                ['gameId', 'index', 'locationLat', 'locationLng', 'geofenceRadius', 'prompt', 'solution', 'hint1', 'hint2', 'story', 'accepted_answers', 'synonyms', 'timeLimitSec'],
            ];

            tasks.forEach((task, index) => {
                taskData.push([
                    task.gameId,
                    index + 1, // K√©nyszer√≠tett index
                    task.locationLat,
                    task.locationLng,
                    task.geofenceRadius,
                    task.prompt,
                    task.solution,
                    task.hint1,
                    task.hint2,
                    task.story,
                    task.accepted_answers,
                    task.synonyms,
                    '' // timeLimitSec - placeholder
                ]);
            });

            // Workbook √©s Munkalapok l√©trehoz√°sa
            const workbook = XLSX.utils.book_new();
            const gamesSheet = XLSX.utils.aoa_to_sheet(gameData);
            const tasksSheet = XLSX.utils.aoa_to_sheet(taskData);
            
            XLSX.utils.book_append_sheet(workbook, gamesSheet, "games");
            XLSX.utils.book_append_sheet(workbook, tasksSheet, "tasks");

            // F√°jl ment√©se
            const filename = `${config.title.replace(/\s/g, '_')}_game.xlsx`;
            XLSX.writeFile(workbook, filename);
            
            return true;
        }

        // --- ESEM√âNY FIGYEL≈êK ---

        document.addEventListener('DOMContentLoaded', () => {
            
            // 1. √Ållapot visszat√∂lt√©se a bet√∂lt√©skor
            loadCreatorState();
            
            // 2. Automatikus ment√©s ind√≠t√°sa
            // Ment√©s 5 m√°sodpercenk√©nt
            setInterval(saveCreatorState, 5000); 
            // Ment√©s az oldal elhagy√°sa el≈ëtt
            window.addEventListener('beforeunload', saveCreatorState);
            
            // 3. Esem√©nyfigyel≈ëk
            document.getElementById('save-xlsx-button').addEventListener('click', () => {
                if (saveGameData()) {
                    clearCreatorState(); // T√∂r√∂lj√ºk a mentett √°llapotot sikeres export√°l√°s ut√°n
                }
            });
            
            // Friss√≠ti a GameId-t, ha a Game Title v√°ltozik
            document.getElementById('input-game-title').addEventListener('input', updateGameIds);

            // Kezdeti √ºres sor hozz√°ad√°sa, ha nincs bet√∂ltve √°llapot
            if (document.getElementById('task-table-body').rows.length === 0) {
                 // addTaskRow(); // Kezdeti √ºres sort most elhagyjuk
            }
            
            updateTaskIndices(); // Biztos√≠tjuk, hogy az indexek rendben legyenek
        });
    </script>
</body>
</html>