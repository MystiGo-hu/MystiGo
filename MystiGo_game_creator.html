<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interakt√≠v T√∂rt√©netk√©sz√≠t≈ë</title>
    
    <style>
        /* CSS az elrendez√©shez (Egyoszlopos) */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            background-color: #f4f4f4;
        }

        #form-container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .general-info, .task-group {
            border: 1px solid #0056b3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        .general-info {
            background-color: #e6f7ff;
        }

        .task-group {
            background-color: #f0f8ff;
        }
        
        .input-row {
            display: flex;
            gap: 20px;
        }

        .input-row > div {
            flex: 1;
        }

        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }

        textarea, input[type="text"], select {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        input[readonly] {
            background-color: #eee;
        }

        textarea {
            resize: vertical;
        }

        #plus-button, #save-button {
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 1.1em;
            width: 100%;
            transition: background-color 0.2s;
        }
        
        #plus-button {
            background-color: #4CAF50;
            color: white;
        }
        #plus-button:hover {
            background-color: #45a049;
        }

        #save-button {
            background-color: #007bff;
            color: white;
            margin-top: 30px;
            font-weight: bold;
        }
        #save-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

<div id="form-container">
    <h1>Interakt√≠v T√∂rt√©net & Feladatk√©sz√≠t≈ë</h1>

    <div class="general-info">
        <h2>√Åltal√°nos adatok üìã</h2>
        
        <div class="input-row">
            <div>
                <label for="title">C√≠m</label>
                <input type="text" id="title" placeholder="A kaland c√≠me (pl: A F≈ëv√°ros Rejt√©lye)" oninput="generateId(this.value)">
            </div>
            <div>
                <label for="generated-id">Azonos√≠t√≥ (ID)</label>
                <input type="text" id="generated-id" placeholder="pl: a-fovaros-rejtelye" readonly>
            </div>
        </div>


        <div class="input-row">
            <div>
                <label for="type">T√≠pus</label>
                <select id="type">
                    <option value="normal">Normal</option>
                    <option value="kids">Kids</option>
                    <option value="team">Team</option>
                </select>
            </div>
            <div>
                <label for="cover-image">Bor√≠t√≥k√©p f√°jln√©v</label>
                <input type="text" id="cover-image" placeholder="pl: boritokep.jpg">
            </div>
        </div>

    </div>

    <label for="initial-story">Kezdeti T√∂rt√©net</label>
    <textarea id="initial-story" rows="4" placeholder="√çrd ide a t√∂rt√©net elej√©t, a k√ºldet√©s ind√≠t√°s√°t..."></textarea>
    
    <hr>

    <div id="task-groups-container">
        <div class="task-group" id="task-group-1">
            <h2>Feladat 1. (Helysz√≠n) üìç</h2>
            
            <div class="input-row">
                <div>
                    <label for="task-coords-1">GPS Koordin√°t√°k</label>
                    <input type="text" id="task-coords-1" placeholder="Pl: 47.4979, 19.0402">
                </div>
                <div>
                    <label for="task-radius-1">R√°diusz (m√©terben)</label>
                    <input type="text" id="task-radius-1" placeholder="Pl: 10 (ez a k√∂r sugara)">
                </div>
            </div>

            <label for="task-story-1">Feladathoz Tartoz√≥ T√∂rt√©net</label>
            <textarea id="task-story-1" rows="3" placeholder="A helysz√≠nre √©rkez√©skor megjelen≈ë t√∂rt√©neti r√©sz..."></textarea>

            <label for="task-description-1">Konkr√©t Feladat</label>
            <textarea id="task-description-1" rows="3" placeholder="Mit kell a felhaszn√°l√≥nak csin√°lnia a helysz√≠nen?"></textarea>
            
            <hr style="border-style: dashed;">

            <div class="input-row">
                <div>
                    <label for="task-hint-1-1">Seg√≠ts√©g 1</label>
                    <input type="text" id="task-hint-1-1" placeholder="R√∂vid tipp 1">
                </div>
                <div>
                    <label for="task-hint-2-1">Seg√≠ts√©g 2</label>
                    <input type="text" id="task-hint-2-1" placeholder="R√∂vid tipp 2">
                </div>
                <div>
                    <label for="task-solution-1">Megold√°s</label>
                    <input type="text" id="task-solution-1" placeholder="A helyes v√°lasz">
                </div>
            </div>
        </div>
    </div>

    <button id="plus-button">‚ûï Plusz Feladatcsoport Hozz√°ad√°sa</button>

    <hr>

    <label for="final-story">Z√°r√≥ T√∂rt√©net</label>
    <textarea id="final-story" rows="4" placeholder="√çrd ide a t√∂rt√©net v√©g√©t, a k√ºldet√©s lez√°r√°s√°t..."></textarea>

    <button id="save-button" onclick="saveData()">üíæ Ment√©s (JSON f√°jlk√©nt)</button>

</div>

<script>
    // A vizu√°lis sz√°ml√°l√≥ 1-r≈ël indul a felhaszn√°l√≥i √©lm√©ny √©rdek√©ben
    let taskCounter = 1; 

    // ===================================
    // 1. AZONOS√çT√ì GENER√ÅL√ÅSA
    // ===================================

    function generateId(title) {
        const id = title.toLowerCase()
            .normalize('NFD').replace(/[\u0300-\u036f]/g, "") 
            .replace(/[^a-z0-9\s-]/g, '')
            .trim()
            .replace(/\s+/g, '-');
        
        document.getElementById('generated-id').value = id;
    }

    // ===================================
    // 2. DINAMIKUS MEZ≈êK HOZZ√ÅAD√ÅSA (M≈±k√∂dik)
    // ===================================

    const taskGroupsContainer = document.getElementById('task-groups-container');
    const plusButton = document.getElementById('plus-button');

    plusButton.addEventListener('click', function() {
        taskCounter++;
        const newTaskId = taskCounter;

        const newGroupHTML = `
            <div class="task-group" id="task-group-${newTaskId}">
                <h2>Feladat ${newTaskId}. (Helysz√≠n) üìç</h2>

                <div class="input-row">
                    <div>
                        <label for="task-coords-${newTaskId}">GPS Koordin√°t√°k</label>
                        <input type="text" id="task-coords-${newTaskId}" placeholder="Pl: 47.4979, 19.0402">
                    </div>
                    <div>
                        <label for="task-radius-${newTaskId}">R√°diusz (m√©terben)</label>
                        <input type="text" id="task-radius-${newTaskId}" placeholder="Pl: 10 (ez a k√∂r sugara)">
                    </div>
                </div>

                <label for="task-story-${newTaskId}">Feladathoz Tartoz√≥ T√∂rt√©net</label>
                <textarea id="task-story-${newTaskId}" rows="3" placeholder="A helysz√≠nre √©rkez√©skor megjelen≈ë t√∂rt√©neti r√©sz..."></textarea>

                <label for="task-description-${newTaskId}">Konkr√©t Feladat</label>
                <textarea id="task-description-${newTaskId}" rows="3" placeholder="Mit kell a felhaszn√°l√≥nak csin√°lnia a helysz√≠nen?"></textarea>

                <hr style="border-style: dashed;">

                <div class="input-row">
                    <div>
                        <label for="task-hint-1-${newTaskId}">Seg√≠ts√©g 1</label>
                        <input type="text" id="task-hint-1-${newTaskId}" placeholder="R√∂vid tipp 1">
                    </div>
                    <div>
                        <label for="task-hint-2-${newTaskId}">Seg√≠ts√©g 2</label>
                        <input type="text" id="task-hint-2-${newTaskId}" placeholder="R√∂vid tipp 2">
                    </div>
                    <div>
                        <label for="task-solution-${newTaskId}">Megold√°s</label>
                        <input type="text" id="task-solution-${newTaskId}" placeholder="A helyes v√°lasz">
                    </div>
                </div>
            </div>
        `;
        taskGroupsContainer.insertAdjacentHTML('beforeend', newGroupHTML);
    });
    
    // ===================================
    // 3. ADATOK GY≈∞JT√âSE √âS MENT√âSE (JSON - Index 0-t√≥l)
    // ===================================

    function saveData() {
        const title = document.getElementById('title').value || "N√©vtelen Kaland";
        const gameId = document.getElementById('generated-id').value || title.toLowerCase().replace(/[^a-z0-9]+/g, '-');
        const type = document.getElementById('type').value;
        const coverImage = document.getElementById('cover-image').value;
        const initialStory = document.getElementById('initial-story').value;
        const finalStory = document.getElementById('final-story').value;
        
        let tasks = [];
        let firstTaskCoords = null; 

        const taskGroups = document.querySelectorAll('.task-group');
        
        taskGroups.forEach((group, index) => { // A 'index' itt 0, 1, 2, ...
            const currentTaskId = index + 1; // Ezt haszn√°ljuk az input ID-khez (pl. 1, 2, 3...)
            const coordsInput = document.getElementById(`task-coords-${currentTaskId}`).value;
            const radiusInput = document.getElementById(`task-radius-${currentTaskId}`).value;

            let lat = '';
            let lng = '';
            if (coordsInput) {
                const parts = coordsInput.split(',').map(c => c.trim());
                if (parts.length === 2) {
                    lat = parts[0];
                    lng = parts[1];
                    if (index === 0) {
                        firstTaskCoords = { lat, lng };
                    }
                }
            }

            tasks.push({
                gameId: gameId, 
                // ITT INDUL AZ INDEX 0-R√ìL, AHOGY K√âRTED:
                index: index, 
                locationLat: lat,
                locationLng: lng,
                geofenceRadius: radiusInput || '0',
                story: document.getElementById(`task-story-${currentTaskId}`).value,
                prompt: document.getElementById(`task-description-${currentTaskId}`).value,
                hint1: document.getElementById(`task-hint-1-${currentTaskId}`).value,
                hint2: document.getElementById(`task-hint-2-${currentTaskId}`).value,
                solution: document.getElementById(`task-solution-${currentTaskId}`).value
            });
        });

        // √Åltal√°nos j√°t√©k adatok
        const gameData = {
            id: gameId,
            type: type,
            title: title,
            age: '',
            price: '0',
            description: initialStory,
            startLocationLat: firstTaskCoords ? firstTaskCoords.lat : '',
            startLocationLng: firstTaskCoords ? firstTaskCoords.lng : '',
            endStory: finalStory,
            imageUrl: coverImage
        };

        const outputData = {
            game_info: [gameData],
            tasks: tasks
        };

        // JSON f√°jl gener√°l√°sa √©s let√∂lt√©se
        const jsonString = JSON.stringify(outputData, null, 2);
        const blob = new Blob([jsonString], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `${gameId}_data.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert(`Az adatok sikeresen mentve lettek ${a.download} n√©ven!`);
    }
</script>

</body>
</html>